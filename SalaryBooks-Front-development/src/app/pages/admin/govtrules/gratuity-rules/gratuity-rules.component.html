<admin-app-dashboard-header></admin-app-dashboard-header>

<div class="br-mainpanel">
    <div class="br-pageheader">
        <nav class="breadcrumb pd-0 mg-0 tx-12">
            <a class="breadcrumb-item" routerLink="/admin">Dashboard</a>
            <a class="breadcrumb-item">Government Rules</a>
            <a class="breadcrumb-item active">Gratuity Rule</a>
        </nav>
    </div>

    <div class="br-pagetitle">
        <i class="icon icon ion-card"></i>
        <div>
            <h4>Gratuity Rule</h4>
            <p class="mg-b-0">Create, define Gratuity Rule</p>
        </div>
    </div>

    <div class="br-pagebody pd-x-20 pd-sm-x-30" id="gratuity-submit-section">
        <div class="br-section-wrapper">
            <h6 class="br-section-label mb-3" *ngIf="editActionId == ''; else editHeader">Define Gratuity Rule</h6>
            <ng-template #editHeader>
                <h6 class="br-section-label mb-3">Update Gratuity Rule</h6>
            </ng-template>

            <div class="form-layout form-layout-6">
                <form [formGroup]="gratuityRuleForm">
                    <div class="row no-gutters">
                        <div class="col-3 col-sm-3">
                            No of Employee&nbsp;<span class="text-danger">*</span>
                        </div>

                        <div class="col-3 col-sm-3">
                            <ngx-select-dropdown formControlName="employee_no_rule" [options]="rulesMaster" class="form-control" [config]="{search:false, placeholder: 'Select Operand'}"></ngx-select-dropdown>
                            <p class="error-element" *ngIf="gratuityRuleForm.controls.employee_no_rule.hasError('required') && (gratuityRuleForm.controls.employee_no_rule.dirty)">This field is required</p>
                        </div>

                        <div class="col-3 col-sm-3">
                            <input class="form-control" formControlName="employee_no" type="number">
                            <p class="error-element" *ngIf="gratuityRuleForm.controls.employee_no.hasError('required') && (gratuityRuleForm.controls.employee_no.dirty)">This field is required</p>
                            <p class="error-element" *ngIf="gratuityRuleForm.controls.employee_no.hasError('pattern') && (gratuityRuleForm.controls.employee_no.dirty)">The value should be numeric</p>
                        </div>

                        <div class="col-3 col-sm-3">
                            <ngx-select-dropdown formControlName="employee_no_applicable" [options]="applicableMaster" class="form-control" [config]="{search:false, placeholder: 'Choose One'}"></ngx-select-dropdown>
                            <p class="error-element" *ngIf="gratuityRuleForm.controls.employee_no_applicable.hasError('required') && (gratuityRuleForm.controls.employee_no_applicable.dirty)">This field is required</p>
                        </div>
                    </div>

                    <div class="row no-gutters">
                        <div class="col-3 col-sm-3">
                            No of service year&nbsp;<span class="text-danger">*</span>
                        </div>

                        <div class="col-3 col-sm-3">
                            <ngx-select-dropdown formControlName="service_year_no_rule" [options]="rulesMaster" class="form-control" [config]="{search:false, placeholder: 'Select Operand'}"></ngx-select-dropdown>
                            <p class="error-element" *ngIf="gratuityRuleForm.controls.service_year_no_rule.hasError('required') && (gratuityRuleForm.controls.service_year_no_rule.dirty)">This field is required</p>
                        </div>

                        <div class="col-3 col-sm-3">
                            <input class="form-control" formControlName="service_year_no" type="number">
                            <p class="error-element" *ngIf="gratuityRuleForm.controls.service_year_no.hasError('required') && (gratuityRuleForm.controls.service_year_no.dirty)">This field is required</p>
                            <p class="error-element" *ngIf="gratuityRuleForm.controls.service_year_no.hasError('pattern') && (gratuityRuleForm.controls.service_year_no.dirty)">The value should be numeric</p>
                        </div>

                        <div class="col-3 col-sm-3">
                            <ngx-select-dropdown formControlName="service_year_no_applicable" [options]="applicableMaster" class="form-control" [config]="{search:false, placeholder: 'Choose One'}"></ngx-select-dropdown>
                            <p class="error-element" *ngIf="gratuityRuleForm.controls.service_year_no_applicable.hasError('required') && (gratuityRuleForm.controls.service_year_no_applicable.dirty)">This field is required</p>
                        </div>
                    </div>

                    <div class="row no-gutters">
                        <div class="col-3 col-sm-3">
                            Fifth year attendance&nbsp;<span class="text-danger">*</span>
                        </div>

                        <div class="col-3 col-sm-3">
                            <ngx-select-dropdown formControlName="fifth_year_atrendance_rule" [options]="rulesMaster" class="form-control" [config]="{search:false, placeholder: 'Select Operand'}"></ngx-select-dropdown>
                            <p class="error-element" *ngIf="gratuityRuleForm.controls.fifth_year_atrendance_rule.hasError('required') && (gratuityRuleForm.controls.fifth_year_atrendance_rule.dirty)">This field is required</p>
                        </div>

                        <div class="col-3 col-sm-3">
                            <input class="form-control" formControlName="fifth_year_atrendance" type="number">
                            <p class="error-element" *ngIf="gratuityRuleForm.controls.fifth_year_atrendance.hasError('required') && (gratuityRuleForm.controls.fifth_year_atrendance.dirty)">This field is required</p>
                            <p class="error-element" *ngIf="gratuityRuleForm.controls.fifth_year_atrendance.hasError('pattern') && (gratuityRuleForm.controls.fifth_year_atrendance.dirty)">The value should be numeric</p>
                        </div>

                        <div class="col-3 col-sm-3">
                            <ngx-select-dropdown formControlName="fifth_year_atrendance_applicable" [options]="applicableMaster" class="form-control" [config]="{search:false, placeholder: 'Choose One'}"></ngx-select-dropdown>
                            <p class="error-element" *ngIf="gratuityRuleForm.controls.fifth_year_atrendance_applicable.hasError('required') && (gratuityRuleForm.controls.fifth_year_atrendance_applicable.dirty)">This field is required</p>
                        </div>
                    </div>

                    <div class="row no-gutters">
                        <div class="col-3 col-sm-3">
                            Maximum Gratuity Annual&nbsp;<span class="text-danger">*</span>
                        </div>

                        <div class="col-3 col-sm-3">
                            <ngx-select-dropdown formControlName="max_gratuity_anual_rule" [options]="rulesMaster" class="form-control" [config]="{search:false, placeholder: 'Select Operand'}"></ngx-select-dropdown>
                            <p class="error-element" *ngIf="gratuityRuleForm.controls.max_gratuity_anual_rule.hasError('required') && (gratuityRuleForm.controls.max_gratuity_anual_rule.dirty)">This field is required</p>
                        </div>

                        <div class="col-3 col-sm-3">
                            <input class="form-control" formControlName="max_gratuity_anual" type="number">
                            <p class="error-element" *ngIf="gratuityRuleForm.controls.max_gratuity_anual.hasError('required') && (gratuityRuleForm.controls.max_gratuity_anual.dirty)">This field is required</p>
                            <p class="error-element" *ngIf="gratuityRuleForm.controls.max_gratuity_anual.hasError('pattern') && (gratuityRuleForm.controls.max_gratuity_anual.dirty)">The value should be numeric</p>
                        </div>

                        <div class="col-3 col-sm-3">
                            <ngx-select-dropdown formControlName="max_gratuity_anual_applicable" [options]="applicableMaster" class="form-control" [config]="{search:false, placeholder: 'Choose One'}"></ngx-select-dropdown>
                            <p class="error-element" *ngIf="gratuityRuleForm.controls.max_gratuity_anual_applicable.hasError('required') && (gratuityRuleForm.controls.max_gratuity_anual_applicable.dirty)">This field is required</p>
                        </div>
                    </div>

                    <div class="row no-gutters bd-1">
                        <div class="col-3 col-sm-3">
                            Income Tax&nbsp;<span class="text-danger">*</span>
                        </div>
                        <div class="col-3 col-sm-3">
                            <ngx-select-dropdown formControlName="income_tax_applicable" [options]="applicableMaster" class="form-control" [config]="{search:false, placeholder: 'Choose One'}"></ngx-select-dropdown>
                            <p class="error-element" *ngIf="gratuityRuleForm.controls.income_tax_applicable.hasError('required') && (gratuityRuleForm.controls.income_tax_applicable.dirty)">This field is required</p>
                        </div>
                        <div class="col-6 col-sm-6"></div>
                    </div>

                    <div class="row no-gutters bd-1">
                        <div class="col-3 col-sm-3">
                            Effective from&nbsp;<span class="text-danger">*</span>
                        </div>
                        <div class="col-3 col-sm-3">
                            <dp-date-picker [config]="{'disableKeypress': true, 'format': 'MM/DD/YYYY'}" formControlName="effective_date" theme="dp-material" attachTo=".mat-input-wrapper"></dp-date-picker>
                            <p class="error-element" *ngIf="gratuityRuleForm.controls.effective_date.hasError('required') && (gratuityRuleForm.controls.effective_date.dirty)">This field is required</p>
                        </div>
                        <div class="col-6 col-sm-6"></div>
                    </div>

                    <div class="row no-gutters bd-1">
                        <div class="col-12 col-sm-12" style="border-right: 1px solid #ced4da;">
                            <button class="btn btn-info" [disabled]="!gratuityRuleForm.valid" (click)="create($event)" type="submit" *ngIf="editActionId == ''; else editButtonSection">
                                <span>SAVE</span>
                            </button>

                            <ng-template #editButtonSection>
                                <button type="button" (click)="cancelEdit()" class="btn btn-danger mg-r-5">
                                    <span>CANCEL</span>
                                </button>
                                <button type="submit" [disabled]="!gratuityRuleForm.valid" (click)="update($event)" class="btn btn-info">
                                    <span>UPDATE RULE</span>
                                </button>
                            </ng-template>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="br-pagebody pd-x-20 pd-sm-x-30">
        <div class="br-section-wrapper">
            <h6 class="br-section-label">View, manage, update Gratuity rules</h6>
            <div class="table-wrapper">
                <table class="table display responsive nowrap wd-100p" datatable [dtOptions]="dtOptions" id="my-datatable">
                    <thead>
                        <tr>
                            <th class="">SL No</th>
                            <th class="">Action</th>
                            <th class="">Govt Doc No</th>
                            <th class="">Wef</th>
                            <th class="text-center">Total Employees</th>
                            <th class="text-center">Total Service Years</th>
                            <th class="text-center">5th Yr Attendance</th>
                            <th class="text-center">Max Gratuity</th>
                            <th class="">Income Tax</th>
                        </tr>
                    </thead>
                    <tbody>

                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <button id="historymmodalbutton" [hidden]="true" data-toggle="modal" data-target="#historymodal"></button>
    <div id="historymodal" tabindex='-1' class="modal fade effect-slide-in-right">
        <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
            <div class="modal-content tx-size-sm">
                <div class="modal-header pd-x-20">
                    <h6 class="tx-14 mg-b-0 tx-uppercase tx-inverse tx-bold">View Edit History</h6>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body pd-20">
                    <div class="">
                        <table class="table display responsive nowrap wd-100p table-responsive" datatable [dtOptions]="dtOptionsHistory" id="history-datatable">
                            <thead>
                                <th class="">SL No</th>
                                <th class="">Time</th>
                                <th class="">Updated By</th>
                                <th class="">Govt Doc No</th>
                                <th class="">Wef</th>
                                <th class="text-center">Total Employees</th>
                                <th class="text-center">Total Service Years</th>
                                <th class="text-center">5th Yr Attendance</th>
                                <th class="text-center">Max Gratuity</th>
                                <th class="">Income Tax</th>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn text-uppercase btn-secondary tx-size-xs" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <admin-app-dashboard-footer></admin-app-dashboard-footer>
</div>